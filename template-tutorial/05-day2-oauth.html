<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Template Tutorial</title>
    <link rel="canonical" href="https://github.com/romerobu/manual-workshop-infra/template-tutorial/05-day2-oauth.html">
    <link rel="prev" href="05-day2-config.html">
    <link rel="next" href="05-day2-operators.html#operators">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://github.com/romerobu/manual-workshop-infra">Template Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="template-tutorial" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#minikube">Setup Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-deploy.html">2. Deploy Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#package">Build Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-deploy.html#deploy">Deploy Dervice</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-hub-setup.html">3. Deploy Hub setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-hub-setup.html#hub">3.1 Hub setup</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-sno-setup.html">4. Deploy Managed setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-sno-setup.html">4.1. Managed setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-sno-setup-helm.html#charts">4.2. Helm charts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-day2-config.html">5. Day 2</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#oauth">5.1 Configure Identity Providers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-day2-operators.html#operators">5.2 Deploy Operators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-day2-monitoring.html#monitoring">5.3 Configure Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-day2-namespace.html#namespace">5.4 Namespace configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-day2-nmstate.html#namespace">5.5 NMstate configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-day2-vault.html#namespace">5.6 Vault configuration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Template Tutorial</a></li>
    <li><a href="05-day2-config.html">5. Day 2</a></li>
    <li><a href="#oauth">5.1 Configure Identity Providers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/romerobu/manual-workshop-infra/edit/master/documentation/modules/ROOT/pages/05-day2-oauth.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_configure_identity_providers"><a class="anchor" href="#_configure_identity_providers"></a>Configure Identity Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you can see, there is already a local identity provider configured but we want to override current users and integrate with other identity providers like LDAP Free Ipa provider and keycloak.</p>
</div>
<div class="paragraph">
<p>For LDAP apart form integrating against the server we also need to synchronize groups and users.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s deploy the oauth resources required and verify how groups are synchronized.</p>
</div>
<div class="paragraph">
<p>Disclaimer: keycloak and FreeIPA server are running on argo hub cluster.</p>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    helm:
      parameters:
        - name: global.oauth.enabled
          value: 'true'
        - name: oauth.oauth.keycloak.clientid
          value: myclient-&lt;name&gt;
        - name: oauth.oauth.keycloak.issuer
          value: &gt;-
            <a href="https://keycloak-keycloak.apps.argo-hub.&lt;domain&gt;&gt;.opentlc.com/realms/myrealm-&lt;name&gt" class="bare">https://keycloak-keycloak.apps.argo-hub.&lt;domain&gt;&gt;.opentlc.com/realms/myrealm-&lt;name&gt</a>;
        - name: oauth.oauth.keycloak.data
          value: "your keycloak secret" *
        - name: oauth.oauth.ldap.sync.ldap_url
          value: 'ldap://&lt;nodeport:port&gt;'
        - name: global.nmstate.enabled
          value: 'false'
        - name: global.monitoring.enabled
          value: 'false'
        - name: global.namespace.enabled
          value: 'false'
        - name: global.bookinfo.enabled
          value: 'false'
        - name: operators.nmstate.enabled
          value: 'false'</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Keycloack secret</strong>: Login to argo-hub console, find keycloack url, login as myuser-&lt;name&gt;/myuser-&lt;name&gt;, naviagte to your realm, then go to your client and  find your secret on Credentials tab.</p>
</div>
<div class="paragraph">
<p>If you take a look to the helm charts you will notice we do not only need to update oauth but create others resources needed for integration like secrets, cm and cron job for syncying groups.</p>
</div>
<div class="paragraph">
<p>Sync waves are needed to make sure those resources like secrets and cm for authentication exists when we update Oauth config, otherwise openshift-authentication will become Degraded.
When you update oauth values, and update existing Application you can notice how they are created in phases and not all at the same time.</p>
</div>
<div class="paragraph">
<p>For groups syncying, cron job shows last 5 executions, including the state according to the result (failed or success).</p>
</div>
<div class="paragraph">
<p>Furthermore you can notice some resources with no status (white fields). Those resources are created by Openshift for configuration issues but they are not managed by argo, that&#8217;s why argo is not tracking them.
<a href="https://argo-cd.readthedocs.io/en/stable/user-guide/resource_tracking/">Resource tracking</a> has been set to annotation+label on argo instance.</p>
</div>
<div class="paragraph">
<p>Once every resource is deployed, verify authentication cluster operator is OK, logout and log in back. Then you should see new identity providers listed.</p>
</div>
<div class="listingblock lines_7 console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">oc get co

oc get oauth cluster -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can try keycloack server with myuser-&lt;name&gt;/myuser-&lt;name&gt;.</p>
</div>
<div class="paragraph">
<p>You can try login to LDAP server with user paul/"" who is an admin user.
You can try login to LDAP server with user mark/"" who is an viewer user.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="05-day2-config.html">5. Day 2</a></span>
  <span class="next"><a href="05-day2-operators.html#operators">5.2 Deploy Operators</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
