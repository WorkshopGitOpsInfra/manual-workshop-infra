== Configure namespace

Part of day 2 configurations are setting namespace scoped configurations for managing networking and quotas for apps, as well as setting RBAC.

In this example, based on the last app deployment we are going to deploy some resources and objects quotas by namespace.

Therefore we are going to set some cluster and local roles.

Finally we are going to deploy a Network Policy to prevent traffic to the app. You can try enabling/disabling this feature to see how traffic is allowed and denied.

Go to your working branch and create a file called *values-namespace.yaml*:

[.lines_7]
[.console-input]
[source, shell,subs="+macros,+attributes"]
----
namespace:
  enabled: true # Enable dependency
  networkpolicy:
    enabled: true
---- 

Then create the Application on argocd-infra instance:

[.lines_7]
[.console-input]
[source, shell,subs="+macros,+attributes"]
----
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sno-<name>-namespace
  namespace: openshift-gitops
spec:
  destination:
    server: 'https://kubernetes.default.svc'
  project: default
  source:
    helm:
      valueFiles:
        - values-namespace.yaml 
    path: .
    repoURL: 'https://github.com/<your_user>/helm-infra-gitops-workshop.git'
    targetRevision: sno-<name>
  syncPolicy:
    automated:
      prune: true
      selfHeal: true                                                       
---- 

Then deploy an example app on argocd-apps instance:

[.lines_7]
[.console-input]
[source, shell,subs="+macros,+attributes"]
----
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sno-<name>-app
  namespace: openshift-operators
spec:
  destination:
    server: 'https://kubernetes.default.svc'
  project: default
  source:
    helm:
      parameters:
        - name: app.enabled
          value: 'true' 
    path: .
    repoURL: 'https://github.com/<your_user>/helm-infra-gitops-workshop.git'
    targetRevision: sno-<name>
  syncPolicy:
    automated:
      prune: true
      selfHeal: true                                                       
---- 

Once you update the Application you want be able to create more than 4 pods in namespace app. Try to update replicas deployment to see if quota has been correctly applied by argo.

image::app-replicas.png[]
image::quota-applied.png[]

Deployment never progess to 5 replicas, and argo stays in Progressing trying to reconcile a not allowed values of replicas. Finally set it back to 1 replica.

Then if you try to navigate to app route you will see you are not allowed:

image::traffic-not-allowed.png[]

Then disable network policy and verify how you have traffic access:

image::traffic-allowed.png[]
